\section{Аналитическая часть}

% После прочтения аналит. части человек должен сделать вывод о применимости конкретного алгоритма в его конкретной ситуации

% В аналитической части описать условия применимости алгоритма в принципе (примеры и контрпримеры - при наличии доступного объема текста)

% Таблица в конце аналитического раздела

% Констр. + аналит.: на вход - информация о полигонах

В данной части под <<сценой>> понимается виртуальное пространство, в котором расположены объекты, предназначенные для визуализации.

\subsection{Описание объектов сцены}

В данном разделе будут описаны свойства объектов, которыми он должен обладать для моделирования его движения и столкновения с другими объектами.

Для визуализации объекта, он должен содержать следующую информацию:
\begin{itemize}
    \item геометрическая информация, какую форму имеет объект;
    \item информация о местоположении в пространстве (с учётом поворота и масштабирования);
    \item информация о цвете и/или текстуре объекта.
\end{itemize}

Для моделирования движения и столкновения объектов, объекты должны содержать следующую информацию:
\begin{itemize}
    \item информация о <<коллайдере>> (как правило, упрощённая форма исходного объекта, которая используется при обнаружении столкновений);
    \item информация о физических свойствах объекта (скорость, ускорение, масса).
\end{itemize}

\subsection{Выбор представления объектов сцены}

Далее будут рассмотрены возможные способы представления объектов сцены.

\subsubsection{Каркасная модель}

Объект представляется с помощью его вершин и рёбер, без каких-либо поверхностей.

Характеристики каркасной модели:
% Преимущества:
\begin{itemize}
    \item простота;
    \item позволяет получить базовое представление о форме объекта;
    \item быстрая визуализация;
    \item не позволяет производить реалистическое освещение, для которого требуется информация о гранях объекта;
    \item не содержит информации, нужной для обнаружения столкновений.
\end{itemize}

% Недостатки:
% \begin{itemize}
%     \item не позволяет производить реалистическое освещение, для которого требуется информация о гранях объекта;
%     \item не содержит информации, нужной для обнаружения столкновений.
% \end{itemize}

\subsubsection{Поверхностная модель}

Объект представляется аппроксимированно, в виде набора поверхностей.
% Поверхность можно задать разными способами, например, уравнением или системой уравнений.
Набор поверхностей можно задать как аналитически (уравнением или системой уравнений), так и в виде полигональной сетки.
% Часто поверхность представляется в виде набора граней (обычно треугольных), которые, в свою очередь, состоят из набора вершин исходного объекта.
Часто бывает проще задать поверхности в виде полигональной сетки: набора граней и набора вершин, из которых грани состоят.

Характеристики поверхностной модели:
% Преимущества:
\begin{itemize}
    \item простота;
    \item возможность учёта освещения;
    \item возможность достижения высокого уровня реализма;
    \item содержит информацию о поверхностях, которая нужна при обнаружении столкновений объектов;
    \item не математически точное представление, аппроксимация.
\end{itemize}

% Недостатки:
% \begin{itemize}
%     \item не математически точное представление, аппроксимация.
% \end{itemize}

\subsubsection{Твердотельная модель}

Существует несколько методов представления твердотельных моделей: метод констркутивного представления (англ. Constructive representation, сокращённо C -- rep) и метод граничного представления (англ. Boundary representation, сокращённо B -- rep). % @Cite
Оба метода предоставляют наиболее полное описание объекта, включая его внешнюю форму и внутреннюю структуру.

Характеристики твердотельной модели:
% Преимущества:
\begin{itemize}
    \item математически точное представление;
    \item наиболее полное описание структуры объекта.
    \item сложность;
    \item требовательность к памяти;
    \item содержит излишнюю информацию, которая не будет использована при обнаружении столкновений объектов.
\end{itemize}

% Недостатки:
% \begin{itemize}
%     \item сложность;
%     \item требовательность к памяти;
%     \item содержит излишнюю информацию, которая не будет использована при обнаружении столкновений объектов.
% \end{itemize}

\subsubsection*{Вывод}

На основе проведённого анализа различных способов представления объектов сцены, была выбрана поверхностная модель, так как она обладает всей информацией, нужной для обнаружения столкновений объектов и учёта освещения, а также является менее требовательной к памяти по сравнению с твёрдотельной моделью.

% \subsection{Выбор алгоритма удаления невидимых линий и поверхностей}

% \subsubsection{Алгоритм Робертса}

% \subsubsection{Алгоритм обратной трассировки лучей}

% \subsubsection{Алгоритм Варнока}

% \subsubsection{Алгоритм, использующий z-буфер}

% \subsubsection*{Вывод}

\subsection{Выбор алгоритмов обнаружения коллизий}

В данном разделе будут проанализированы алгоритмы обнаружения коллизий и выбраны те из них, которые будут использоваться в разработанной программе.

\subsubsection{Алгоритм обнаружения коллизий сферы относительно сферы}

Алгоритм обнаружения коллизий сферы относительно сферы очень прост: две сферы пересекаются, если длина вектора, проведённого из центра одной сферы к центру другой, будет меньше суммы радиусов этих сфер. % @Cite

Два объекта считаются <<столкнувшимися>>, если пересекаются их сферические оболочки.

Таким образом, алгоритм будет достаточно точно обнаруживать коллизии сферообразных объектов, но менее точно --- для объектов, сильно отличающихся от сфер, например, для длинных тонких объектов.

\subsubsection{Алгоритм AABB}

Согласно алгоритму ограничивающего прямоугольного параллелепипеда, выровненного по осям (англ. Axis Aligned Bounding Box, сокращённо AABB), объекты заключаются в оболочки из прямоугольных параллелепипедов, чьи рёбра параллельны осям координат, после чего применяется несколько последовательных тестов для определения, пересекаются эти оболочки или нет. % @Cite

\subsubsection{Алгоритм OBB}

Согласно алгоритму ориентированного ограничивающего параллелепипеда (англ. Oriented Bounding Box, сокращённо OBB), объекты заключаются в оболочки из прямоугольных параллелепипедов, чья ориентация совпадает с ориентацией самих объектов, после чего проверяется, пересекаются эти оболочки или нет. % @Cite

Его преимущество относительно алгоритма AABB заключается в том, что при повороте объекта в пространстве, поворачивается также и его OBB --- оболочка, в то время как AABB --- оболочку надо пересчитывать заново.

Однако проверку пересечения AABB --- оболочек выполнять гораздо быстрее и проще, чем проверку пересечения OBB --- оболочек.

\subsubsection{Алгоритм GJK}

Алгоритм Гильберта --- Джонсона --- Кирти (англ. Gilbert --- Johnson --- Keerthi, сокращённо GJK) позволяет обнаруживать пересечения любых выпуклых многогранников.
В алгоритме используется геометрическая операция под названием <<сумма Минковского>> (иногда ошибочно называемая разностью Минковского). % @Cite
Для двух множеств точек $A, B \subset \mathbb{R}^3$ сумма Минковского определяется как:
$$
A \oplus B = \{ \boldsymbol{a} + \boldsymbol{b} : \boldsymbol{a} \in A, \boldsymbol{b} \in B \},
$$
где, для векторов $\boldsymbol{a} = (a_x, a_y, a_z)$ и $\boldsymbol{b} = (b_x, b_y, b_z)$, сумма определена, как
$$
\boldsymbol{a} + \boldsymbol{b} := (a_x + b_x, a_y + b_y, a_z + b_z).
$$

У суммы Минковского есть несколько полезных свойств, которые используются в алгоритме.
\begin{enumerate}
    \item Сумма Минковского двух выпуклых многогранников есть выпуклый многогранник.
    \item Если два выпуклых многогранника $P$ и $Q$ пересекаются, то центр координат находится внутри выпуклой оболочки $P \oplus \{ -\boldsymbol{q} : \boldsymbol{q} \in Q \}$.
    \item Если найдётся хотя бы одно множество точек $S \subseteq P \oplus \{ -\boldsymbol{q} : \boldsymbol{q} \in Q \}$, которое заключает в себе центр координат, то и $P \oplus \{ -\boldsymbol{q} : \boldsymbol{q} \in Q \}$ заключает в себе центр координат.
\end{enumerate}

Алгоритм заключается в поиске многогранника, составленного из точек суммы Минковского, который содержит в себе центр координат.
Также в алгоритме используются несколько хитростей, позволяющих считать не всю сумму Минковского целиком, а только её часть.

\subsubsection*{Вывод}

Ниже приведена сравнительная таблица алгоритмов обнаружения коллизий.

\noindent
\begin{table}[H]
    \caption{Сравнение алгоритмов обнаружения коллизий}
    \label{tab:collisions}
\begin{adjustbox}{width=1\textwidth}
    \begin{tabular}{|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|}
        \hline
        &
        Алгоритм обнаружения коллизий сферы относительно сферы
        &
        Алгоритм AABB
        &
        Алгоритм OBB
        &
        Алгоритм GJK
        \\
        \hline
        Вычислительная нагрузка
        &
        % Алгоритм обнаружения коллизий сферы относительно сферы
        Низкая
        &
        % Алгоритм AABB
        Низкая
        &
        % Алгоритм OBB
        Средняя
        &
        % Алгоритм GJK
        Высокая
        \\
        \hline
        Точность обнаружения коллизий у сложных объектов
        &
        % Алгоритм обнаружения коллизий сферы относительно сферы
        Низкая
        &
        % Алгоритм AABB
        Низкая
        &
        % Алгоритм OBB
        Средняя
        &
        % Алгоритм GJK
        Высокая
        \\
        \hline
        Сложность реализации
        &
        % Алгоритм обнаружения коллизий сферы относительно сферы
        Низкая
        &
        % Алгоритм AABB
        Низкая
        &
        % Алгоритм OBB
        Средняя
        &
        % Алгоритм GJK
        Высокая
        \\
        \hline
    \end{tabular}
\end{adjustbox}
\end{table}

% На основе проведённого анализа алгоритмов обнаружения коллизий, для реализации в программе были выбраны алгоритмы AABB (для обнаружения коллизий на ранней стадии) и GJK (для обнаружения коллизий на поздней стадии).
На основе проведённого анализа алгоритмов обнаружения коллизий, для реализации в программе был выбран алгоритм AABB, по следующим причинам:
\begin{itemize}
    \item простота реализации;
    \item достаточность для моделирования упругих столкновений объектов в пространстве;
    \item алгоритм часто используется для обнаружения коллизий на ранней стадии, и впоследствии его можно будет использовать в паре с GJK для более точного обнаружения коллизий. % @Cite
\end{itemize}

% Выбор сразу нескольких алгоритмов обнаружения коллизий обусловлен тем, что в программе объекты могут быть часто расположены на больших, относительно своих размеров, расстояниях друг от друга, и эффективнее будет на ранней стадии убрать из рассмотрения те объекты, чьи менее точные выпуклые оболочки не пересекаются, ведь если не пересекаются и они, то тем более не пересекаются и сами объекты.
% Такой подход часто применяется в физических движках и носит название --- обнаружение коллизий на ранней стадии (англ. Narrow Phase Collision Detection). % @Cite

% \subsection{Выбор алгоритмов разрешения коллизий}

% \subsubsection{Алгоритм EPA}

% \subsubsection*{Вывод}

\subsection{Выбор модели освещения}

В данном разделе будут описаны три модели освещения и выбрана одна из них для дальнейшей реализации в программе.
Под источником света далее понимается направленный источник света, солнце.
Вектор направления света задан и одинаков для всех точек сцены.

\subsubsection{Простая модель освещения}

В простой модели освещения интенсивность света, отражённого гранью объекта зависит от угла между нормалью к грани и направлением источника света.
Таким образом, с максимальной интенсивностью будут освещены грани, нормали к которым противонаправлены вектору направления источника света, а с минимальной интенсивностью будут освещены грани, нормали к которым составляют прямой или острый угол с вектором направления источника света.

\subsubsection{Модель освещения Гуро}

В модели освещения Гуро интенсивность света, отражённого гранью объекта может быть неоднородной.
Интенсивность отражённого света зависит от угла между нормалью к вершине и направлением источника света.
Для вычисления значения интенсивности отражённого света в каждой точке грани проводится интерполяция значений интенсивности отражённого света каждой вершиной, принадлежащей этой грани.

\subsubsection{Модель Фонга}

В модели освещения Фонга интенсивность света, отражённого гранью объекта также может быть неоднородной.
Интенсивность отражённого света зависит от угла между нормалью к вершине и направлением источника света.
Для вычисления значения интенсивность отражённого света в каждой точке грани проводится интерполяция нормалей каждой вершины, принадлежащей этой грани, после чего интенсивность вычисляется в зависимости от угла между интерполированной нормалью и вектором направления источника света.

\subsubsection*{Вывод}

Ниже приведена сравнительная таблица моделей освещения.

\noindent
\begin{table}[H]
    \caption{Сравнение моделей освещения}
    \label{tab:lighting-models}
\begin{adjustbox}{width=1\textwidth}
    \begin{tabular}{|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|p{.20\textwidth}|}
        \hline
        &
        Простая модель освещения
        &
        Модель освещения Гуро
        &
        Модель Фонга
        \\
        \hline
        Реалистичность изображения
        &
        % Простая модель освещения
        Низкая
        &
        % Модель освещения Гуро
        Средняя
        &
        % Модель Фонга
        Высокая
        \\
        \hline
        Вычислительная нагрузка
        &
        % Простая модель освещения
        Низкая
        &
        % Модель освещения Гуро
        Средняя
        &
        % Модель Фонга
        Высокая
        \\
        \hline
        Сложность реализации
        &
        % Простая модель освещения
        Низкая
        &
        % Модель освещения Гуро
        Средняя
        &
        % Модель Фонга
        Средняя
        \\
        \hline
    \end{tabular}
\end{adjustbox}
\end{table}

Несмотря на большие вычислительные затраты и относительную сложность реализации, закраска по Фонгу позволяет достичь более реалистичного изображения, в связи с чем для дальнейшей реализации была выбрана именно она.
